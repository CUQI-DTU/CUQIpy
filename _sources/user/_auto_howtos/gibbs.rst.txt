
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "user/_auto_howtos/gibbs.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_user__auto_howtos_gibbs.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_user__auto_howtos_gibbs.py:


Gibbs sampling
==============

    This tutorial shows how to use CUQIpy to perform Gibbs sampling.
    Gibbs sampling is a Markov chain Monte Carlo (MCMC) method for
    sampling a joint probability distribution.

    Opposed to jointly sampling the distribution simultaneously, Gibbs
    sampling samples the variables of the distribution sequentially,
    one variable at a time. When a variable represents a random vector, the
    whole vector is sampled simultaneously.
    
    The sampling of each variable is done by sampling from the conditional
    distribution of that variable given (fixed, previously sampled) values
    of the other variables.

    This is often a very efficient way of sampling from a joint
    distribution if the conditional distributions are easy to sample
    from. This is one way to exploit the structure of the joint
    distribution. On the other hand, if the conditional distributions
    are highly correlated and/or are difficult to sample from, then
    Gibbs sampling can be very inefficient.

    For these reasons, Gibbs sampling is often a double-edged sword,
    that needs to be used in the right context.

.. GENERATED FROM PYTHON SOURCE LINES 30-33

Setup
-----
We start by importing the necessary modules

.. GENERATED FROM PYTHON SOURCE LINES 33-42

.. code-block:: Python


    import numpy as np
    import matplotlib.pyplot as plt
    from cuqi.testproblem import Deconvolution1D
    from cuqi.distribution import Gaussian, Gamma, JointDistribution, GMRF, LMRF
    from cuqi.sampler import HybridGibbs, LinearRTO, Conjugate, UGLA, ConjugateApprox

    np.random.seed(0)








.. GENERATED FROM PYTHON SOURCE LINES 43-56

Forward model and data
------------------------
We define the forward model and data.
Here we use a 1D deconvolution problem, so the forward model is linear,
that is:

.. math::
   \mathbf{y} = \mathbf{A} \mathbf{x}

where :math:`\mathbf{A}` is the convolution matrix, and :math:`\mathbf{x}` is the input signal.

We load this example from the testproblem library of CUQIpy and visualize the
true solution (sharp signal) and data (convolved signal).

.. GENERATED FROM PYTHON SOURCE LINES 56-72

.. code-block:: Python


    # Model and data
    A, y_obs, probinfo = Deconvolution1D(phantom='square').get_components()

    # Get dimension of signal
    n = A.domain_dim

    # Plot exact solution and observed data
    plt.subplot(121)
    probinfo.exactSolution.plot()
    plt.title('exact solution')

    plt.subplot(122)
    y_obs.plot()
    plt.title("Observed data")




.. image-sg:: /user/_auto_howtos/images/sphx_glr_gibbs_001.png
   :alt: exact solution, Observed data
   :srcset: /user/_auto_howtos/images/sphx_glr_gibbs_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    Text(0.5, 1.0, 'Observed data')



.. GENERATED FROM PYTHON SOURCE LINES 73-98

Hierarchical Bayesian model
---------------------------

We define the following hierarchical model:

.. math::

    \begin{align}
        d &\sim \mathrm{Gamma}(1, 10^{-4}) \\
        l &\sim \mathrm{Gamma}(1, 10^{-4}) \\
        \mathbf{x} &\sim \mathrm{GMRF}(\mathbf{0}, d) \\
        \mathbf{y} &\sim \mathcal{N}(\mathbf{A} \mathbf{x}, l^{-1} \mathbf{I}_m)
    \end{align}

where :math:`\mathbf{y}` is the observed data, and :math:`\mathbf{x}`
is the unknown signal. The hyperparameters :math:`d` and :math:`l` are
the precision of the prior distribution of :math:`\mathbf{x}` and
the noise, respectively.

The prior distribution of :math:`\mathbf{x}` is a Gaussian Markov random
field (GMRF) with zero mean and precision :math:`d`. It can
be viewed as a Gaussian prior on the differences between neighboring
elements of :math:`\mathbf{x}`.

In CUQIpy the model can be defined as follows:

.. GENERATED FROM PYTHON SOURCE LINES 98-111

.. code-block:: Python


    # Define distributions
    d = Gamma(1, 1e-4)
    l = Gamma(1, 1e-4)
    x = GMRF(np.zeros(n), lambda d: d)
    y = Gaussian(A, lambda l: 1/l)

    # Combine into a joint distribution
    joint = JointDistribution(d, l, x, y)

    # View the joint distribution
    print(joint)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    JointDistribution(
        Equation: 
            p(d,l,x,y) = p(d)p(l)p(x|d)p(y|x,l)
        Densities: 
            d ~ CUQI Gamma.
            l ~ CUQI Gamma.
            x ~ CUQI GMRF. Conditioning variables ['d'].
            y ~ CUQI Gaussian. Conditioning variables ['x', 'l'].
     )




.. GENERATED FROM PYTHON SOURCE LINES 112-115

Notice that the joint distribution prints a mathematical expression
for the density functions that make up :math:`p(d,l,\mathbf{x},\mathbf{y})`.
In this case they are all distributions, but this need not be the case.

.. GENERATED FROM PYTHON SOURCE LINES 117-124

Defining the posterior distribution
------------------------------------

Now we define the posterior distribution, which is the joint distribution
conditioned on the observed data. That is, :math:`p(d, l, \mathbf{x} \mid \mathbf{y}=\mathbf{y}_\mathrm{obs})`

This is done in the following way:

.. GENERATED FROM PYTHON SOURCE LINES 124-131

.. code-block:: Python


    # Define posterior by conditioning on the data
    posterior = joint(y=y_obs)

    # View the structure of the posterior
    print(posterior)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    JointDistribution(
        Equation: 
            p(d,l,x|y) ∝ p(d)p(l)p(x|d)L(x,l|y)
        Densities: 
            d ~ CUQI Gamma.
            l ~ CUQI Gamma.
            x ~ CUQI GMRF. Conditioning variables ['d'].
            y ~ CUQI Gaussian Likelihood function. Parameters ['x', 'l'].
     )




.. GENERATED FROM PYTHON SOURCE LINES 132-135

Notice that after conditioning on the data, the distribution associated with
:math:`\mathbf{y}` became a likelihood function and that the posterior is now
a joint distribution of the variables :math:`d`, :math:`l`, :math:`\mathbf{x}`.

.. GENERATED FROM PYTHON SOURCE LINES 137-158

Gibbs Sampler
-------------

The hierarchical model above has some important properties that we
can exploit to make the sampling more efficient. First, note that
the Gamma distribution are conjugate priors for the precision of
the Gaussian distributions. This means that we can efficiently sample
from :math:`d` and :math:`l` conditional on the other variables.

Second, note that the prior distribution of :math:`\mathbf{x}` is
a Gaussian Markov random field (GMRF) and that the distribution for
:math:`\mathbf{y}` is also Gaussian with a Linear operator acting
on :math:`\mathbf{x}` as the mean variable. This means that we can
efficiently sample from :math:`\mathbf{x}` conditional on the other
variables using the ``LinearRTO`` sampler.

Taking these two facts into account, we can define a HybridGibbs sampler
that uses the ``Conjugate`` sampler for :math:`d` and :math:`l` and
the ``LinearRTO`` sampler for :math:`\mathbf{x}`.

This is done in CUQIpy as follows:

.. GENERATED FROM PYTHON SOURCE LINES 158-174

.. code-block:: Python


    # Define sampling strategy
    sampling_strategy = {
        'x': LinearRTO(),
        'd': Conjugate(),
        'l': Conjugate()
    }

    # Define HybridGibbs sampler
    sampler = HybridGibbs(posterior, sampling_strategy)

    # Run sampler
    sampler.warmup(200)
    sampler.sample(1000)
    samples = sampler.get_samples()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Warmup:   0%|          | 0/200 [00:00<?, ?it/s]    Warmup:   8%|▊         | 15/200 [00:00<00:01, 140.28it/s]    Warmup:  15%|█▌        | 30/200 [00:00<00:01, 141.53it/s]    Warmup:  22%|██▎       | 45/200 [00:00<00:01, 141.53it/s]    Warmup:  30%|███       | 60/200 [00:00<00:00, 141.70it/s]    Warmup:  38%|███▊      | 75/200 [00:00<00:00, 141.69it/s]    Warmup:  45%|████▌     | 90/200 [00:00<00:00, 140.49it/s]    Warmup:  52%|█████▎    | 105/200 [00:00<00:00, 141.06it/s]    Warmup:  60%|██████    | 120/200 [00:00<00:00, 141.33it/s]    Warmup:  68%|██████▊   | 135/200 [00:00<00:00, 141.75it/s]    Warmup:  75%|███████▌  | 150/200 [00:01<00:00, 141.76it/s]    Warmup:  82%|████████▎ | 165/200 [00:01<00:00, 142.03it/s]    Warmup:  90%|█████████ | 180/200 [00:01<00:00, 142.16it/s]    Warmup:  98%|█████████▊| 195/200 [00:01<00:00, 142.26it/s]    Warmup: 100%|██████████| 200/200 [00:01<00:00, 141.72it/s]
    Sample:   0%|          | 0/1000 [00:00<?, ?it/s]    Sample:   2%|▏         | 15/1000 [00:00<00:06, 143.07it/s]    Sample:   3%|▎         | 30/1000 [00:00<00:06, 143.00it/s]    Sample:   4%|▍         | 45/1000 [00:00<00:06, 143.08it/s]    Sample:   6%|▌         | 60/1000 [00:00<00:06, 142.59it/s]    Sample:   8%|▊         | 75/1000 [00:00<00:06, 141.56it/s]    Sample:   9%|▉         | 90/1000 [00:00<00:06, 141.96it/s]    Sample:  10%|█         | 105/1000 [00:00<00:06, 140.97it/s]    Sample:  12%|█▏        | 120/1000 [00:00<00:06, 141.41it/s]    Sample:  14%|█▎        | 135/1000 [00:00<00:06, 141.63it/s]    Sample:  15%|█▌        | 150/1000 [00:01<00:05, 141.87it/s]    Sample:  16%|█▋        | 165/1000 [00:01<00:05, 141.97it/s]    Sample:  18%|█▊        | 180/1000 [00:01<00:05, 142.13it/s]    Sample:  20%|█▉        | 195/1000 [00:01<00:05, 142.17it/s]    Sample:  21%|██        | 210/1000 [00:01<00:05, 142.22it/s]    Sample:  22%|██▎       | 225/1000 [00:01<00:05, 142.40it/s]    Sample:  24%|██▍       | 240/1000 [00:01<00:05, 142.17it/s]    Sample:  26%|██▌       | 255/1000 [00:01<00:05, 142.39it/s]    Sample:  27%|██▋       | 270/1000 [00:01<00:05, 142.43it/s]    Sample:  28%|██▊       | 285/1000 [00:02<00:05, 142.46it/s]    Sample:  30%|███       | 300/1000 [00:02<00:04, 142.52it/s]    Sample:  32%|███▏      | 315/1000 [00:02<00:04, 142.66it/s]    Sample:  33%|███▎      | 330/1000 [00:02<00:04, 142.83it/s]    Sample:  34%|███▍      | 345/1000 [00:02<00:04, 142.78it/s]    Sample:  36%|███▌      | 360/1000 [00:02<00:04, 142.91it/s]    Sample:  38%|███▊      | 375/1000 [00:02<00:04, 142.49it/s]    Sample:  39%|███▉      | 390/1000 [00:02<00:04, 142.73it/s]    Sample:  40%|████      | 405/1000 [00:02<00:04, 142.85it/s]    Sample:  42%|████▏     | 420/1000 [00:02<00:04, 142.83it/s]    Sample:  44%|████▎     | 435/1000 [00:03<00:03, 142.91it/s]    Sample:  45%|████▌     | 450/1000 [00:03<00:03, 142.92it/s]    Sample:  46%|████▋     | 465/1000 [00:03<00:03, 143.07it/s]    Sample:  48%|████▊     | 480/1000 [00:03<00:03, 142.95it/s]    Sample:  50%|████▉     | 495/1000 [00:03<00:03, 142.93it/s]    Sample:  51%|█████     | 510/1000 [00:03<00:03, 142.89it/s]    Sample:  52%|█████▎    | 525/1000 [00:03<00:03, 142.97it/s]    Sample:  54%|█████▍    | 540/1000 [00:03<00:03, 142.94it/s]    Sample:  56%|█████▌    | 555/1000 [00:03<00:03, 142.92it/s]    Sample:  57%|█████▋    | 570/1000 [00:03<00:03, 142.65it/s]    Sample:  58%|█████▊    | 585/1000 [00:04<00:02, 142.53it/s]    Sample:  60%|██████    | 600/1000 [00:04<00:02, 142.75it/s]    Sample:  62%|██████▏   | 615/1000 [00:04<00:02, 142.82it/s]    Sample:  63%|██████▎   | 630/1000 [00:04<00:02, 142.80it/s]    Sample:  64%|██████▍   | 645/1000 [00:04<00:02, 142.68it/s]    Sample:  66%|██████▌   | 660/1000 [00:04<00:02, 142.74it/s]    Sample:  68%|██████▊   | 675/1000 [00:04<00:02, 142.84it/s]    Sample:  69%|██████▉   | 690/1000 [00:04<00:02, 142.95it/s]    Sample:  70%|███████   | 705/1000 [00:04<00:02, 142.79it/s]    Sample:  72%|███████▏  | 720/1000 [00:05<00:01, 142.70it/s]    Sample:  74%|███████▎  | 735/1000 [00:05<00:01, 142.73it/s]    Sample:  75%|███████▌  | 750/1000 [00:05<00:01, 142.81it/s]    Sample:  76%|███████▋  | 765/1000 [00:05<00:01, 142.96it/s]    Sample:  78%|███████▊  | 780/1000 [00:05<00:01, 143.00it/s]    Sample:  80%|███████▉  | 795/1000 [00:05<00:01, 142.99it/s]    Sample:  81%|████████  | 810/1000 [00:05<00:01, 143.03it/s]    Sample:  82%|████████▎ | 825/1000 [00:05<00:01, 143.02it/s]    Sample:  84%|████████▍ | 840/1000 [00:05<00:01, 143.12it/s]    Sample:  86%|████████▌ | 855/1000 [00:05<00:01, 143.08it/s]    Sample:  87%|████████▋ | 870/1000 [00:06<00:00, 143.16it/s]    Sample:  88%|████████▊ | 885/1000 [00:06<00:00, 143.10it/s]    Sample:  90%|█████████ | 900/1000 [00:06<00:00, 143.07it/s]    Sample:  92%|█████████▏| 915/1000 [00:06<00:00, 142.93it/s]    Sample:  93%|█████████▎| 930/1000 [00:06<00:00, 142.94it/s]    Sample:  94%|█████████▍| 945/1000 [00:06<00:00, 143.04it/s]    Sample:  96%|█████████▌| 960/1000 [00:06<00:00, 142.99it/s]    Sample:  98%|█████████▊| 975/1000 [00:06<00:00, 142.98it/s]    Sample:  99%|█████████▉| 990/1000 [00:06<00:00, 142.79it/s]    Sample: 100%|██████████| 1000/1000 [00:07<00:00, 142.68it/s]




.. GENERATED FROM PYTHON SOURCE LINES 175-182

Analyze results
---------------

After sampling we can inspect the results. The samples are stored
as a dictionary with the variable names as keys. Samples for each 
variable is stored as a CUQIpy Samples object which contains the
many convenience methods for diagnostics and plotting of MCMC samples.

.. GENERATED FROM PYTHON SOURCE LINES 182-186

.. code-block:: Python


    # Plot credible intervals for the signal
    samples['x'].plot_ci(exact=probinfo.exactSolution)




.. image-sg:: /user/_auto_howtos/images/sphx_glr_gibbs_002.png
   :alt: gibbs
   :srcset: /user/_auto_howtos/images/sphx_glr_gibbs_002.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    [<matplotlib.lines.Line2D object at 0x7fa8afccef00>, <matplotlib.lines.Line2D object at 0x7fa8afe89070>, <matplotlib.collections.FillBetweenPolyCollection object at 0x7fa8afda6e70>]



.. GENERATED FROM PYTHON SOURCE LINES 187-188

Trace plot for d

.. GENERATED FROM PYTHON SOURCE LINES 188-190

.. code-block:: Python

    samples['d'].plot_trace(figsize=(8,2))




.. image-sg:: /user/_auto_howtos/images/sphx_glr_gibbs_003.png
   :alt: d, d
   :srcset: /user/_auto_howtos/images/sphx_glr_gibbs_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array([[<Axes: title={'center': 'd'}>, <Axes: title={'center': 'd'}>]],
          dtype=object)



.. GENERATED FROM PYTHON SOURCE LINES 191-192

Trace plot for l

.. GENERATED FROM PYTHON SOURCE LINES 192-194

.. code-block:: Python

    samples['l'].plot_trace(figsize=(8,2))




.. image-sg:: /user/_auto_howtos/images/sphx_glr_gibbs_004.png
   :alt: l, l
   :srcset: /user/_auto_howtos/images/sphx_glr_gibbs_004.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array([[<Axes: title={'center': 'l'}>, <Axes: title={'center': 'l'}>]],
          dtype=object)



.. GENERATED FROM PYTHON SOURCE LINES 195-219

Switching to a piecewise constant prior
---------------------------------------

Notice that while the sampling went well in the previous example,
the posterior distribution did not match the characteristics of
the exact solution. We can improve this result by switching to a
prior that better matches the exact solution :math:`\mathbf{x}`.

One choice is the Laplace difference prior, which assumes a
Laplace distribution for the differences between neighboring
elements of :math:`\mathbf{x}`. That is,

.. math::

    \mathbf{x} \sim \text{LMRF}(d^{-1}),

which means that :math:`x_i-x_{i-1} \sim \mathrm{Laplace}(0, d^{-1})`.

This prior is implemented in CUQIpy as the ``LMRF`` distribution.
To update our model we simply need to replace the ``GMRF`` distribution
with the ``LMRF`` distribution. Note that the Laplace distribution
is defined via a scale parameter, so we invert the parameter :math:`d`.

This laplace distribution and new posterior can be defined as follows:

.. GENERATED FROM PYTHON SOURCE LINES 219-232

.. code-block:: Python


    # Define new distribution for x
    x = LMRF(0, lambda d: 1/d, geometry=n)

    # Define new joint distribution with piecewise constant prior
    joint_Ld = JointDistribution(d, l, x, y)

    # Define new posterior by conditioning on the data
    posterior_Ld = joint_Ld(y=y_obs)

    print(posterior_Ld)






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    JointDistribution(
        Equation: 
            p(d,l,x|y) ∝ p(d)p(l)p(x|d)L(x,l|y)
        Densities: 
            d ~ CUQI Gamma.
            l ~ CUQI Gamma.
            x ~ CUQI LMRF. Conditioning variables ['d'].
            y ~ CUQI Gaussian Likelihood function. Parameters ['x', 'l'].
     )




.. GENERATED FROM PYTHON SOURCE LINES 233-247

HybridGibbs Sampler (with Laplace prior)
----------------------------------

Using the same approach as earlier we can define a HybridGibbs sampler
for this new hierarchical model. The only difference is that we
now need to use a different sampler for :math:`\mathbf{x}` because
the ``LinearRTO`` sampler only works for Gaussian distributions.

In this case we use the UGLA (Unadjusted Gaussian Laplace Approximation) sampler
for :math:`\mathbf{x}`. We also use an approximate Conjugate
sampler for :math:`d` which approximately samples from the
posterior distribution of :math:`d` conditional on the other
variables in an efficient manner. For more details see e.g.
`this paper <https://arxiv.org/abs/2104.06919>`.

.. GENERATED FROM PYTHON SOURCE LINES 247-263

.. code-block:: Python


    # Define sampling strategy
    sampling_strategy = {
        'x': UGLA(),
        'd': ConjugateApprox(),
        'l': Conjugate()
    }

    # Define Gibbs sampler
    sampler_Ld = HybridGibbs(posterior_Ld, sampling_strategy)

    # Run sampler
    sampler_Ld.warmup(200)
    sampler_Ld.sample(1000)
    samples_Ld = sampler_Ld.get_samples()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Warmup:   0%|          | 0/200 [00:00<?, ?it/s]    Warmup:   3%|▎         | 6/200 [00:00<00:03, 56.76it/s]    Warmup:   6%|▌         | 12/200 [00:00<00:03, 56.63it/s]    Warmup:   9%|▉         | 18/200 [00:00<00:03, 56.54it/s]    Warmup:  12%|█▏        | 24/200 [00:00<00:03, 56.66it/s]    Warmup:  15%|█▌        | 30/200 [00:00<00:03, 56.61it/s]    Warmup:  18%|█▊        | 36/200 [00:00<00:02, 56.64it/s]    Warmup:  21%|██        | 42/200 [00:00<00:02, 56.75it/s]    Warmup:  24%|██▍       | 48/200 [00:00<00:02, 56.79it/s]    Warmup:  27%|██▋       | 54/200 [00:00<00:02, 56.81it/s]    Warmup:  30%|███       | 60/200 [00:01<00:02, 56.82it/s]    Warmup:  33%|███▎      | 66/200 [00:01<00:02, 56.84it/s]    Warmup:  36%|███▌      | 72/200 [00:01<00:02, 56.86it/s]    Warmup:  39%|███▉      | 78/200 [00:01<00:02, 56.93it/s]    Warmup:  42%|████▏     | 84/200 [00:01<00:02, 56.96it/s]    Warmup:  45%|████▌     | 90/200 [00:01<00:01, 57.06it/s]    Warmup:  48%|████▊     | 96/200 [00:01<00:01, 56.93it/s]    Warmup:  51%|█████     | 102/200 [00:01<00:01, 56.97it/s]    Warmup:  54%|█████▍    | 108/200 [00:01<00:01, 56.95it/s]    Warmup:  57%|█████▋    | 114/200 [00:02<00:01, 56.97it/s]    Warmup:  60%|██████    | 120/200 [00:02<00:01, 57.04it/s]    Warmup:  63%|██████▎   | 126/200 [00:02<00:01, 57.09it/s]    Warmup:  66%|██████▌   | 132/200 [00:02<00:01, 57.09it/s]    Warmup:  69%|██████▉   | 138/200 [00:02<00:01, 56.97it/s]    Warmup:  72%|███████▏  | 144/200 [00:02<00:00, 57.00it/s]    Warmup:  75%|███████▌  | 150/200 [00:02<00:00, 57.07it/s]    Warmup:  78%|███████▊  | 156/200 [00:02<00:00, 57.05it/s]    Warmup:  81%|████████  | 162/200 [00:02<00:00, 57.06it/s]    Warmup:  84%|████████▍ | 168/200 [00:02<00:00, 57.01it/s]    Warmup:  87%|████████▋ | 174/200 [00:03<00:00, 56.99it/s]    Warmup:  90%|█████████ | 180/200 [00:03<00:00, 56.97it/s]    Warmup:  93%|█████████▎| 186/200 [00:03<00:00, 56.96it/s]    Warmup:  96%|█████████▌| 192/200 [00:03<00:00, 56.97it/s]    Warmup:  99%|█████████▉| 198/200 [00:03<00:00, 57.00it/s]    Warmup: 100%|██████████| 200/200 [00:03<00:00, 56.92it/s]
    Sample:   0%|          | 0/1000 [00:00<?, ?it/s]    Sample:   1%|          | 6/1000 [00:00<00:17, 57.10it/s]    Sample:   1%|          | 12/1000 [00:00<00:17, 57.04it/s]    Sample:   2%|▏         | 18/1000 [00:00<00:17, 57.10it/s]    Sample:   2%|▏         | 24/1000 [00:00<00:17, 57.15it/s]    Sample:   3%|▎         | 30/1000 [00:00<00:16, 57.15it/s]    Sample:   4%|▎         | 36/1000 [00:00<00:16, 57.28it/s]    Sample:   4%|▍         | 42/1000 [00:00<00:16, 57.33it/s]    Sample:   5%|▍         | 48/1000 [00:00<00:16, 57.25it/s]    Sample:   5%|▌         | 54/1000 [00:00<00:16, 57.21it/s]    Sample:   6%|▌         | 60/1000 [00:01<00:16, 57.29it/s]    Sample:   7%|▋         | 66/1000 [00:01<00:16, 56.83it/s]    Sample:   7%|▋         | 72/1000 [00:01<00:16, 57.04it/s]    Sample:   8%|▊         | 78/1000 [00:01<00:16, 57.16it/s]    Sample:   8%|▊         | 84/1000 [00:01<00:15, 57.30it/s]    Sample:   9%|▉         | 90/1000 [00:01<00:15, 57.36it/s]    Sample:  10%|▉         | 96/1000 [00:01<00:15, 57.26it/s]    Sample:  10%|█         | 102/1000 [00:01<00:15, 57.31it/s]    Sample:  11%|█         | 108/1000 [00:01<00:15, 57.35it/s]    Sample:  11%|█▏        | 114/1000 [00:01<00:15, 57.38it/s]    Sample:  12%|█▏        | 120/1000 [00:02<00:15, 57.45it/s]    Sample:  13%|█▎        | 126/1000 [00:02<00:15, 57.42it/s]    Sample:  13%|█▎        | 132/1000 [00:02<00:15, 57.45it/s]    Sample:  14%|█▍        | 138/1000 [00:02<00:14, 57.51it/s]    Sample:  14%|█▍        | 144/1000 [00:02<00:14, 57.59it/s]    Sample:  15%|█▌        | 150/1000 [00:02<00:14, 57.50it/s]    Sample:  16%|█▌        | 156/1000 [00:02<00:14, 57.49it/s]    Sample:  16%|█▌        | 162/1000 [00:02<00:14, 57.44it/s]    Sample:  17%|█▋        | 168/1000 [00:02<00:14, 57.50it/s]    Sample:  17%|█▋        | 174/1000 [00:03<00:14, 57.55it/s]    Sample:  18%|█▊        | 180/1000 [00:03<00:14, 57.53it/s]    Sample:  19%|█▊        | 186/1000 [00:03<00:14, 57.50it/s]    Sample:  19%|█▉        | 192/1000 [00:03<00:14, 57.54it/s]    Sample:  20%|█▉        | 198/1000 [00:03<00:13, 57.30it/s]    Sample:  20%|██        | 204/1000 [00:03<00:13, 57.38it/s]    Sample:  21%|██        | 210/1000 [00:03<00:13, 57.36it/s]    Sample:  22%|██▏       | 216/1000 [00:03<00:13, 57.43it/s]    Sample:  22%|██▏       | 222/1000 [00:03<00:13, 57.48it/s]    Sample:  23%|██▎       | 228/1000 [00:03<00:13, 57.50it/s]    Sample:  23%|██▎       | 234/1000 [00:04<00:13, 57.53it/s]    Sample:  24%|██▍       | 240/1000 [00:04<00:13, 57.51it/s]    Sample:  25%|██▍       | 246/1000 [00:04<00:13, 57.52it/s]    Sample:  25%|██▌       | 252/1000 [00:04<00:12, 57.54it/s]    Sample:  26%|██▌       | 258/1000 [00:04<00:12, 57.53it/s]    Sample:  26%|██▋       | 264/1000 [00:04<00:12, 57.53it/s]    Sample:  27%|██▋       | 270/1000 [00:04<00:12, 57.49it/s]    Sample:  28%|██▊       | 276/1000 [00:04<00:12, 57.44it/s]    Sample:  28%|██▊       | 282/1000 [00:04<00:12, 57.43it/s]    Sample:  29%|██▉       | 288/1000 [00:05<00:12, 57.33it/s]    Sample:  29%|██▉       | 294/1000 [00:05<00:12, 57.38it/s]    Sample:  30%|███       | 300/1000 [00:05<00:12, 57.39it/s]    Sample:  31%|███       | 306/1000 [00:05<00:12, 57.43it/s]    Sample:  31%|███       | 312/1000 [00:05<00:11, 57.46it/s]    Sample:  32%|███▏      | 318/1000 [00:05<00:11, 57.59it/s]    Sample:  32%|███▏      | 324/1000 [00:05<00:11, 57.58it/s]    Sample:  33%|███▎      | 330/1000 [00:05<00:11, 57.65it/s]    Sample:  34%|███▎      | 336/1000 [00:05<00:11, 57.63it/s]    Sample:  34%|███▍      | 342/1000 [00:05<00:11, 57.66it/s]    Sample:  35%|███▍      | 348/1000 [00:06<00:11, 57.66it/s]    Sample:  35%|███▌      | 354/1000 [00:06<00:11, 57.44it/s]    Sample:  36%|███▌      | 360/1000 [00:06<00:11, 57.53it/s]    Sample:  37%|███▋      | 366/1000 [00:06<00:11, 57.49it/s]    Sample:  37%|███▋      | 372/1000 [00:06<00:10, 57.49it/s]    Sample:  38%|███▊      | 378/1000 [00:06<00:10, 57.47it/s]    Sample:  38%|███▊      | 384/1000 [00:06<00:10, 57.54it/s]    Sample:  39%|███▉      | 390/1000 [00:06<00:10, 57.47it/s]    Sample:  40%|███▉      | 396/1000 [00:06<00:10, 57.50it/s]    Sample:  40%|████      | 402/1000 [00:07<00:10, 57.58it/s]    Sample:  41%|████      | 408/1000 [00:07<00:10, 57.65it/s]    Sample:  41%|████▏     | 414/1000 [00:07<00:10, 57.62it/s]    Sample:  42%|████▏     | 420/1000 [00:07<00:10, 57.61it/s]    Sample:  43%|████▎     | 426/1000 [00:07<00:09, 57.62it/s]    Sample:  43%|████▎     | 432/1000 [00:07<00:09, 57.62it/s]    Sample:  44%|████▍     | 438/1000 [00:07<00:09, 57.62it/s]    Sample:  44%|████▍     | 444/1000 [00:07<00:09, 57.54it/s]    Sample:  45%|████▌     | 450/1000 [00:07<00:09, 57.51it/s]    Sample:  46%|████▌     | 456/1000 [00:07<00:09, 57.26it/s]    Sample:  46%|████▌     | 462/1000 [00:08<00:09, 57.35it/s]    Sample:  47%|████▋     | 468/1000 [00:08<00:09, 57.19it/s]    Sample:  47%|████▋     | 474/1000 [00:08<00:09, 57.23it/s]    Sample:  48%|████▊     | 480/1000 [00:08<00:09, 57.27it/s]    Sample:  49%|████▊     | 486/1000 [00:08<00:08, 57.37it/s]    Sample:  49%|████▉     | 492/1000 [00:08<00:08, 57.45it/s]    Sample:  50%|████▉     | 498/1000 [00:08<00:08, 57.46it/s]    Sample:  50%|█████     | 504/1000 [00:08<00:08, 57.52it/s]    Sample:  51%|█████     | 510/1000 [00:08<00:08, 57.41it/s]    Sample:  52%|█████▏    | 516/1000 [00:08<00:08, 57.30it/s]    Sample:  52%|█████▏    | 522/1000 [00:09<00:08, 57.41it/s]    Sample:  53%|█████▎    | 528/1000 [00:09<00:08, 57.37it/s]    Sample:  53%|█████▎    | 534/1000 [00:09<00:08, 57.47it/s]    Sample:  54%|█████▍    | 540/1000 [00:09<00:08, 57.42it/s]    Sample:  55%|█████▍    | 546/1000 [00:09<00:07, 57.46it/s]    Sample:  55%|█████▌    | 552/1000 [00:09<00:07, 57.52it/s]    Sample:  56%|█████▌    | 558/1000 [00:09<00:07, 57.45it/s]    Sample:  56%|█████▋    | 564/1000 [00:09<00:07, 57.46it/s]    Sample:  57%|█████▋    | 570/1000 [00:09<00:07, 57.48it/s]    Sample:  58%|█████▊    | 576/1000 [00:10<00:07, 57.53it/s]    Sample:  58%|█████▊    | 582/1000 [00:10<00:07, 57.53it/s]    Sample:  59%|█████▉    | 588/1000 [00:10<00:07, 57.51it/s]    Sample:  59%|█████▉    | 594/1000 [00:10<00:07, 57.52it/s]    Sample:  60%|██████    | 600/1000 [00:10<00:06, 57.50it/s]    Sample:  61%|██████    | 606/1000 [00:10<00:06, 57.52it/s]    Sample:  61%|██████    | 612/1000 [00:10<00:06, 57.51it/s]    Sample:  62%|██████▏   | 618/1000 [00:10<00:06, 57.53it/s]    Sample:  62%|██████▏   | 624/1000 [00:10<00:06, 57.36it/s]    Sample:  63%|██████▎   | 630/1000 [00:10<00:06, 57.43it/s]    Sample:  64%|██████▎   | 636/1000 [00:11<00:06, 57.47it/s]    Sample:  64%|██████▍   | 642/1000 [00:11<00:06, 57.35it/s]    Sample:  65%|██████▍   | 648/1000 [00:11<00:06, 57.37it/s]    Sample:  65%|██████▌   | 654/1000 [00:11<00:06, 56.92it/s]    Sample:  66%|██████▌   | 660/1000 [00:11<00:05, 57.11it/s]    Sample:  67%|██████▋   | 666/1000 [00:11<00:05, 57.26it/s]    Sample:  67%|██████▋   | 672/1000 [00:11<00:05, 57.23it/s]    Sample:  68%|██████▊   | 678/1000 [00:11<00:05, 57.23it/s]    Sample:  68%|██████▊   | 684/1000 [00:11<00:05, 57.38it/s]    Sample:  69%|██████▉   | 690/1000 [00:12<00:05, 57.50it/s]    Sample:  70%|██████▉   | 696/1000 [00:12<00:05, 57.51it/s]    Sample:  70%|███████   | 702/1000 [00:12<00:05, 57.48it/s]    Sample:  71%|███████   | 708/1000 [00:12<00:05, 57.43it/s]    Sample:  71%|███████▏  | 714/1000 [00:12<00:04, 57.51it/s]    Sample:  72%|███████▏  | 720/1000 [00:12<00:04, 57.56it/s]    Sample:  73%|███████▎  | 726/1000 [00:12<00:04, 57.46it/s]    Sample:  73%|███████▎  | 732/1000 [00:12<00:04, 57.53it/s]    Sample:  74%|███████▍  | 738/1000 [00:12<00:04, 57.45it/s]    Sample:  74%|███████▍  | 744/1000 [00:12<00:04, 57.54it/s]    Sample:  75%|███████▌  | 750/1000 [00:13<00:04, 57.61it/s]    Sample:  76%|███████▌  | 756/1000 [00:13<00:04, 57.51it/s]    Sample:  76%|███████▌  | 762/1000 [00:13<00:04, 57.51it/s]    Sample:  77%|███████▋  | 768/1000 [00:13<00:04, 57.50it/s]    Sample:  77%|███████▋  | 774/1000 [00:13<00:03, 57.55it/s]    Sample:  78%|███████▊  | 780/1000 [00:13<00:03, 57.55it/s]    Sample:  79%|███████▊  | 786/1000 [00:13<00:03, 57.54it/s]    Sample:  79%|███████▉  | 792/1000 [00:13<00:03, 57.60it/s]    Sample:  80%|███████▉  | 798/1000 [00:13<00:03, 57.60it/s]    Sample:  80%|████████  | 804/1000 [00:13<00:03, 57.49it/s]    Sample:  81%|████████  | 810/1000 [00:14<00:03, 57.57it/s]    Sample:  82%|████████▏ | 816/1000 [00:14<00:03, 57.41it/s]    Sample:  82%|████████▏ | 822/1000 [00:14<00:03, 57.39it/s]    Sample:  83%|████████▎ | 828/1000 [00:14<00:02, 57.43it/s]    Sample:  83%|████████▎ | 834/1000 [00:14<00:02, 57.60it/s]    Sample:  84%|████████▍ | 840/1000 [00:14<00:02, 57.72it/s]    Sample:  85%|████████▍ | 846/1000 [00:14<00:02, 57.72it/s]    Sample:  85%|████████▌ | 852/1000 [00:14<00:02, 57.66it/s]    Sample:  86%|████████▌ | 858/1000 [00:14<00:02, 57.64it/s]    Sample:  86%|████████▋ | 864/1000 [00:15<00:02, 57.67it/s]    Sample:  87%|████████▋ | 870/1000 [00:15<00:02, 57.69it/s]    Sample:  88%|████████▊ | 876/1000 [00:15<00:02, 57.68it/s]    Sample:  88%|████████▊ | 882/1000 [00:15<00:02, 57.68it/s]    Sample:  89%|████████▉ | 888/1000 [00:15<00:01, 57.72it/s]    Sample:  89%|████████▉ | 894/1000 [00:15<00:01, 57.82it/s]    Sample:  90%|█████████ | 900/1000 [00:15<00:01, 57.76it/s]    Sample:  91%|█████████ | 906/1000 [00:15<00:01, 57.76it/s]    Sample:  91%|█████████ | 912/1000 [00:15<00:01, 57.79it/s]    Sample:  92%|█████████▏| 918/1000 [00:15<00:01, 57.81it/s]    Sample:  92%|█████████▏| 924/1000 [00:16<00:01, 57.84it/s]    Sample:  93%|█████████▎| 930/1000 [00:16<00:01, 57.75it/s]    Sample:  94%|█████████▎| 936/1000 [00:16<00:01, 57.78it/s]    Sample:  94%|█████████▍| 942/1000 [00:16<00:01, 57.80it/s]    Sample:  95%|█████████▍| 948/1000 [00:16<00:00, 57.80it/s]    Sample:  95%|█████████▌| 954/1000 [00:16<00:00, 57.73it/s]    Sample:  96%|█████████▌| 960/1000 [00:16<00:00, 57.70it/s]    Sample:  97%|█████████▋| 966/1000 [00:16<00:00, 57.64it/s]    Sample:  97%|█████████▋| 972/1000 [00:16<00:00, 57.60it/s]    Sample:  98%|█████████▊| 978/1000 [00:17<00:00, 57.59it/s]    Sample:  98%|█████████▊| 984/1000 [00:17<00:00, 57.59it/s]    Sample:  99%|█████████▉| 990/1000 [00:17<00:00, 57.50it/s]    Sample: 100%|█████████▉| 996/1000 [00:17<00:00, 57.54it/s]    Sample: 100%|██████████| 1000/1000 [00:17<00:00, 57.48it/s]




.. GENERATED FROM PYTHON SOURCE LINES 264-269

Analyze results
---------------

Again we can inspect the results.
Here we notice the posterior distribution matches the exact solution much better.

.. GENERATED FROM PYTHON SOURCE LINES 269-272

.. code-block:: Python


    # Plot credible intervals for the signal
    samples_Ld['x'].plot_ci(exact=probinfo.exactSolution)



.. image-sg:: /user/_auto_howtos/images/sphx_glr_gibbs_005.png
   :alt: gibbs
   :srcset: /user/_auto_howtos/images/sphx_glr_gibbs_005.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    [<matplotlib.lines.Line2D object at 0x7fa8ae38a2a0>, <matplotlib.lines.Line2D object at 0x7fa8ae38acc0>, <matplotlib.collections.FillBetweenPolyCollection object at 0x7fa8b0106e70>]



.. GENERATED FROM PYTHON SOURCE LINES 273-274

.. code-block:: Python

    samples_Ld['d'].plot_trace(figsize=(8,2))



.. image-sg:: /user/_auto_howtos/images/sphx_glr_gibbs_006.png
   :alt: d, d
   :srcset: /user/_auto_howtos/images/sphx_glr_gibbs_006.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array([[<Axes: title={'center': 'd'}>, <Axes: title={'center': 'd'}>]],
          dtype=object)



.. GENERATED FROM PYTHON SOURCE LINES 275-276

.. code-block:: Python

    samples_Ld['l'].plot_trace(figsize=(8,2))



.. image-sg:: /user/_auto_howtos/images/sphx_glr_gibbs_007.png
   :alt: l, l
   :srcset: /user/_auto_howtos/images/sphx_glr_gibbs_007.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    array([[<Axes: title={'center': 'l'}>, <Axes: title={'center': 'l'}>]],
          dtype=object)




.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 29.865 seconds)


.. _sphx_glr_download_user__auto_howtos_gibbs.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: gibbs.ipynb <gibbs.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: gibbs.py <gibbs.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: gibbs.zip <gibbs.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
